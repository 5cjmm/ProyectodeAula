<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopMaster - Informe de Ventas</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-white border-r border-gray-200 p-6">
            <div class="flex flex-col items-center mb-10">
                <div class=" p-4 rounded-xl shadow-sm border border-gray-100">
                    <img th:src="@{/images/logo.png}" alt="ShopMaster"
                        class="h-28 w-auto object-contain drop-shadow-md">
                </div>
            </div>

            <input type="hidden" id="tiendaId" th:value="${tiendaId}">
            <input type="hidden" id="rolUsuario" th:value="${session.rolUsuario}">
            <nav class="space-y-2">
                <!-- Dashboard -->
                <a id="linkDashboard"
                    class="flex items-center gap-3 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3 12l2-2m0 0l7-7 7 7m-9 2v8m4-8v8m4 0h-4m-4 0H5m14 0a2 2 0 002-2V9a2 2 0 00-.586-1.414l-7-7a2 2 0 00-2.828 0l-7 7A2 2 0 003 9v9a2 2 0 002 2h14z" />
                    </svg>
                    Dashboard
                </a>

                <!-- Inventario -->
                <a id="linkInventario"
                    class="flex items-center gap-3 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 7h18M3 12h18M3 17h18" />
                    </svg>
                    Inventario
                </a>

                <!-- Proveedores -->
                <a id="linkProveedores"
                    class="flex items-center gap-3 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M8 7a4 4 0 118 0m-4 4a4 4 0 014 4v1H8v-1a4 4 0 014-4z" />
                    </svg>
                    Proveedores
                </a>

                <!-- Deudas -->
                <a id="linkDeudas" class="flex items-center gap-3 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 8c-1.657 0-3 .895-3 2v2c0 1.105 1.343 2 3 2s3-.895 3-2v-2c0-1.105-1.343-2-3-2zm0 8v2m0-10V6" />
                    </svg>
                    Deudas
                </a>

                <!-- Punto de Venta -->
                <a id="linkPuntoVenta"
                    class="flex items-center gap-3 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3 3h18v18H3zM7 7h10v4H7zM7 15h10v2H7z" />
                    </svg>
                    Punto de Venta
                </a>

                <!-- Informe de Ventas -->
                <a id="linkInforme" class="flex items-center gap-3 px-3 py-2 bg-cyan-50 text-cyan-700 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-6m4 6V9m4 8V5M5 3v18h14V3H5z" />
                    </svg>
                    Informe de Ventas
                </a>
                <a id="linkPrediccion"
                    class="flex items-center gap-3 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M3 3h14v2H3V3zm0 4h10v2H3V7zm0 4h6v2H3v-2z" />
                    </svg>
                    Predicci√≥n
                </a>
                <!-- Gesti√≥n de Tenderos -->
                <a id="linkTendero" class="flex items-center gap-3 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M5.121 17.804A4 4 0 018 16h8a4 4 0 012.879 1.804M12 14a4 4 0 100-8 4 4 0 000 8z" />
                    </svg>
                    Gesti√≥n de Tenderos
                </a>

                <!-- Tiendas -->
                <a id="linkTiendas" class="flex items-center gap-3 px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                    </svg>
                    Tiendas
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Header -->
            <header class="bg-white border-b border-gray-200 shadow-sm">
                <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
                    <h1 class="text-xl font-semibold text-gray-800">Informe de Ventas</h1>

                    <div class="relative">
                        <button id="userMenuButton"
                            class="flex items-center gap-3 px-3 py-2 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition">

                            <!-- ‚ö™ SVG Avatar con c√≠rculo gris -->
                            <div
                                class="w-9 h-9 rounded-full border-2 border-gray-300 bg-gray-100 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="26" height="26">
                                    <path fill="none"
                                        d="M8.007 24.93A4.996 4.996 0 0 1 13 20h6a4.996 4.996 0 0 1 4.993 4.93a11.94 11.94 0 0 1-15.986 0M20.5 12.5A4.5 4.5 0 1 1 16 8a4.5 4.5 0 0 1 4.5 4.5" />
                                    <path fill="#0891b2"
                                        d="M26.749 24.93A13.99 13.99 0 1 0 2 16a13.9 13.9 0 0 0 3.251 8.93l-.02.017c.07.084.15.156.222.239c.09.103.187.2.28.3q.418.457.87.87q.14.124.28.242q.48.415.99.782c.044.03.084.069.128.1v-.012a13.9 13.9 0 0 0 16 0v.012c.044-.031.083-.07.128-.1q.51-.368.99-.782q.14-.119.28-.242q.451-.413.87-.87c.093-.1.189-.197.28-.3c.071-.083.152-.155.222-.24ZM16 8a4.5 4.5 0 1 1-4.5 4.5A4.5 4.5 0 0 1 16 8M8.007 24.93A4.996 4.996 0 0 1 13 20h6a4.996 4.996 0 0 1 4.993 4.93a11.94 11.94 0 0 1-15.986 0" />
                                </svg>
                            </div>

                            <span id="userGreeting" th:text="'Hola, ' + ${usuario.username}"
                                class="text-sm font-medium text-gray-700">
                                Hola, Usuario
                            </span>

                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
                                <path fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="1.5" d="m6 9l6 6l6-6" />
                            </svg>
                        </button>

                        <!-- üîΩ Men√∫ desplegable -->
                        <div id="userDropdown"
                            class="absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg opacity-0 translate-y-[-10px] scale-95 pointer-events-none transition-all duration-200 z-50">

                            <div class="px-4 py-3 border-b border-gray-100">
                                <p class="text-sm text-gray-700">Rol:</p>
                                <p id="userRole"
                                    th:text="${#lists.contains(usuario.roles, 'ROLE_ADMIN') ? 'Administrador' : 'Tendero'}"
                                    class="font-semibold text-gray-900">
                                    Administrador
                                </p>
                            </div>

                            <a id="linkPerfil"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition">
                                Perfil
                            </a>

                            <button id="logoutBtn"
                                class="w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
                                    <g fill="none">
                                        <path fill="#f00034"
                                            d="M12 3a1 1 0 0 1 .117 1.993L12 5H7a1 1 0 0 0-.993.883L6 6v12a1 1 0 0 0 .883.993L7 19h4.5a1 1 0 0 1 .117 1.993L11.5 21H7a3 3 0 0 1-2.995-2.824L4 18V6a3 3 0 0 1 2.824-2.995L7 3zm5.707 5.464l2.828 2.829a1 1 0 0 1 0 1.414l-2.828 2.829a1 1 0 1 1-1.414-1.415L17.414 13H12a1 1 0 1 1 0-2h5.414l-1.121-1.121a1 1 0 0 1 1.414-1.415" />
                                    </g>
                                </svg>
                                Cerrar sesi√≥n
                            </button>
                        </div>
                    </div>
                </div>
            </header>


            <!-- Main Content -->
            <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <!-- Filter Section -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6 mb-8">
                    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                        <!-- Date Filter -->
                        <div class="flex items-center gap-4">
                            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">Filtrar por
                                fecha:</label>
                            <div class="relative">
                                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                    </path>
                                </svg>
                                <input id="fechaFiltro" type="date" placeholder="dd/mm/aaaa"
                                    class="pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 focus:bg-white w-48">
                            </div>
                            <button id="btnBuscar"
                                class="bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-[1.02] hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                <span class="flex items-center gap-2">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                    Buscar
                                </span>
                            </button>
                        </div>

                        <!-- Generate PDF Button -->
                        <button id="btnGenPdf"
                            class="bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue500 hover:to-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-[1.02] hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                            <span class="flex items-center gap-2">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                    </path>
                                </svg>
                                Generar PDF
                            </span>
                        </button>
                    </div>
                </div>

                <!-- Table Section -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                    <!-- Table Header -->
                    <div class="bg-gradient-to-r from-blue-400 to-blue-500 px-6 py-4">
                        <div class="grid grid-cols-5 gap-4 text-white font-semibold text-sm">
                            <div class="flex items-center gap-2">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                                </svg>
                                Nombre
                            </div>
                            <div class="flex items-center gap-2">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path>
                                </svg>
                                Cantidad
                            </div>
                            <div class="flex items-center gap-2">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1">
                                    </path>
                                </svg>
                                Precio Unitario (COP)
                            </div>
                            <div class="flex items-center gap-2">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z">
                                    </path>
                                </svg>
                                Total (COP)
                            </div>
                            <div class="flex items-center gap-2">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                    </path>
                                </svg>
                                Fecha
                            </div>
                        </div>
                    </div>

                    <!-- Table Body -->
                    <div id="ventasBody" class="bg-blue-50">
                        <!-- filas din√°micas -->
                    </div>
                    <div id="totalRow" class="grid grid-cols-5 gap-4 px-6 py-4 bg-gradient-to-r from-amber-100 to-amber-200 border-t-2 border-amber-300 hidden">
                        <div class="text-sm text-amber-900 font-bold">TOTAL VENTAS</div>
                        <div id="totalCantidad" class="text-sm text-amber-800 font-bold">0</div>
                        <div class="text-sm text-amber-800 font-bold">-</div>
                        <div id="totalMonto" class="text-sm text-amber-900 font-bold text-lg">$0</div>
                        <div id="totalFecha" class="text-sm text-amber-700 font-bold">-</div>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="flex justify-center items-center space-x-4 mt-8">
                    <button id="btnPrev"
                        class="bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-medium px-6 py-3 rounded-lg transition-all duration-200 transform hover:scale-[1.02] hover:shadow-lg">
                        <span class="flex items-center gap-2">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Anterior
                        </span>
                    </button>
                    <span id="paginaActual"
                        class="bg-white border-2 border-blue-200 text-blue-700 font-bold px-4 py-3 rounded-lg shadow-sm">
                        1
                    </span>
                    <button id="btnNext"
                        class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-medium px-6 py-3 rounded-lg transition-all duration-200 transform hover:scale-[1.02] hover:shadow-lg">
                        <span class="flex items-center gap-2">
                            Siguiente
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7">
                                </path>
                            </svg>
                        </span>
                    </button>
                </div>
            </main>

            <script>
                (function(){
                  function fmtCOP(n){ return new Intl.NumberFormat('es-CO',{style:'currency',currency:'COP',maximumFractionDigits:0}).format(n||0); }

                  const tiendaId = document.getElementById('tiendaId').value;
                  const rol = document.getElementById('rolUsuario')?.value;
                  const fechaInput = document.getElementById('fechaFiltro');
                  const btnBuscar = document.getElementById('btnBuscar');
                  const btnGenPdf = document.getElementById('btnGenPdf');
                  const ventasBody = document.getElementById('ventasBody');
                  const totalRow = document.getElementById('totalRow');
                  const totalCantidad = document.getElementById('totalCantidad');
                  const totalMonto = document.getElementById('totalMonto');
                  const totalFecha = document.getElementById('totalFecha');
                  const btnPrev = document.getElementById('btnPrev');
                  const btnNext = document.getElementById('btnNext');
                  const paginaEl = document.getElementById('paginaActual');

                  // Links
                  document.getElementById("linkDashboard").href = `/tiendas/${tiendaId}/dashboard`;
                  document.getElementById("linkInventario").href = `/tiendas/${tiendaId}/inventario`;
                  document.getElementById("linkProveedores").href = `/tiendas/${tiendaId}/proveedores`;
                  document.getElementById("linkDeudas").href = `/tiendas/${tiendaId}/deudas`;
                  document.getElementById("linkPuntoVenta").href = `/tiendas/${tiendaId}/puntoventa`;
                  document.getElementById("linkInforme").href = `/tiendas/${tiendaId}/informe`;
                  document.getElementById("linkPrediccion").href = `/tiendas/${tiendaId}/prediccion`;
                  document.getElementById("linkTendero").href = `/tiendas/${tiendaId}/tendero`;
                  document.getElementById("linkPerfil").href = `/tiendas/${tiendaId}/perfil`;
                  document.getElementById("linkTiendas").href = `/tiendas`;
                  if (rol === 'ROLE_TENDERO') {
                    const tenderoMenu = document.getElementById('linkTendero');
                    const tiendasMenu = document.getElementById('linkTiendas');
                    if (tenderoMenu) tenderoMenu.style.display = 'none';
                    if (tiendasMenu) tiendasMenu.style.display = 'none';
                  }

                  // State
                  let page = 0; const size = 5; let totalPages = 1;
                  const today = new Date();
                  const yyyy = today.getFullYear();
                  const mm = String(today.getMonth()+1).padStart(2,'0');
                  const dd = String(today.getDate()).padStart(2,'0');
                  fechaInput.value = `${yyyy}-${mm}-${dd}`;

                  async function loadVentas(){
                    const fecha = fechaInput.value;
                    const url = `/api/ventas/tienda/${tiendaId}/por-dia?fecha=${fecha}&page=${page}&size=${size}`;
                    const res = await fetch(url);
                    if(!res.ok){ ventasBody.innerHTML = `<div class='px-6 py-6 text-center text-gray-500'>Error al cargar</div>`; return; }
                    const data = await res.json();
                    const ventas = data.content || [];
                    totalPages = data.totalPages || 1;
                    renderRows(ventas, fecha);
                    paginaEl.textContent = (page+1);
                    btnPrev.disabled = page === 0;
                    btnNext.disabled = (page+1) >= totalPages;
                  }

                                    function renderRows(ventas, fecha){
                    ventasBody.innerHTML = '';
                    ventas.forEach(v=>{
                      const fechaTxt = v.fecha ? new Date(v.fecha).toLocaleDateString('es-CO') : '-';
                      if(Array.isArray(v.productos)){
                        v.productos.forEach(p=>{
                          const unit = (p.precioUnitario && p.precioUnitario>0) ? p.precioUnitario : (p.precio || 0);
                          const sub = (p.subtotal && p.subtotal>0) ? p.subtotal : (unit * (p.cantidad||0));
                          const row = document.createElement('div');
                          row.className = 'grid grid-cols-5 gap-4 px-6 py-4 border-b border-blue-100 hover:bg-blue-100 transition-colors';
                          row.innerHTML = `
                            <div class='text-sm text-blue-900 font-medium'>${p.nombre||''}</div>
                            <div class='text-sm text-blue-800'>${p.cantidad||0}</div>
                            <div class='text-sm text-blue-800 font-semibold'>${fmtCOP(unit)}</div>
                            <div class='text-sm text-blue-900 font-bold'>${fmtCOP(sub)}</div>
                            <div class='text-sm text-blue-700'>${fechaTxt}</div>`;
                          ventasBody.appendChild(row);
                        })
                      }
                    });
                                        // El total se carga desde el resumen del d√≠a, no por p√°gina
                                        if(ventas.length === 0){
                                            ventasBody.innerHTML = `<div class='px-6 py-6 text-center text-gray-500'>Sin datos para la fecha seleccionada</div>`;
                                        }
                  }

                                    async function loadResumen(){
                                        const fecha = fechaInput.value;
                                        const url = `/api/ventas/tienda/${tiendaId}/por-dia/resumen?fecha=${fecha}`;
                                        try{
                                            const res = await fetch(url);
                                            if(!res.ok) throw new Error('resumen');
                                            const data = await res.json();
                                            totalRow.classList.remove('hidden');
                                            totalCantidad.textContent = (data.totalCantidad ?? 0);
                                            totalMonto.textContent = fmtCOP(data.totalMonto ?? 0);
                                            totalFecha.textContent = fecha.split('-').reverse().join('/');
                                        }catch(e){
                                            // Ocultar si falla
                                            totalRow.classList.add('hidden');
                                        }
                                    }

                                    btnBuscar.addEventListener('click', ()=>{ page = 0; loadVentas(); loadResumen(); });
                  btnPrev.addEventListener('click', ()=>{ if(page>0){ page--; loadVentas(); } });
                  btnNext.addEventListener('click', ()=>{ if(page+1<totalPages){ page++; loadVentas(); } });
                                    btnGenPdf.addEventListener('click', ()=>{
                                        const fecha = fechaInput.value; window.open(`/api/ventas/tienda/${tiendaId}/informe/pdf?fecha=${fecha}`, '_blank');
                                    });

                                    // User menu dropdown toggle: show/hide on button click, hide on outside click
                                    const userMenuButtonEl = document.getElementById('userMenuButton');
                                    const userDropdownEl = document.getElementById('userDropdown');
                                    if (userMenuButtonEl && userDropdownEl) {
                                        const showDropdown = (show) => {
                                            if (show) {
                                                userDropdownEl.classList.remove('opacity-0','translate-y-[-10px]','scale-95','pointer-events-none');
                                                userDropdownEl.classList.add('opacity-100','translate-y-0','scale-100','pointer-events-auto');
                                            } else {
                                                userDropdownEl.classList.add('opacity-0','translate-y-[-10px]','scale-95','pointer-events-none');
                                                userDropdownEl.classList.remove('opacity-100','translate-y-0','scale-100','pointer-events-auto');
                                            }
                                        };

                                        userMenuButtonEl.addEventListener('click', (ev) => {
                                            ev.stopPropagation();
                                            const isOpen = !userDropdownEl.classList.contains('opacity-0');
                                            showDropdown(!isOpen);
                                        });

                                        // prevent clicks inside dropdown from closing it
                                        userDropdownEl.addEventListener('click', (ev) => ev.stopPropagation());

                                        // close when clicking outside
                                        document.addEventListener('click', () => showDropdown(false));
                                    }

                                    // init
                                    loadVentas();
                                    loadResumen();
                })();
            </script>
</body>

</html>